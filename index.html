<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kompetenzorientiertes Portfolio</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React und ReactDOM via CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel für JSX im Browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Lucide-Icons CDN -->
  <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.min.js"></script>
  <!-- Recharts via CDN -->
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
</head>
<body class="min-h-screen bg-gray-100">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const {
      Plus, X, Star, Circle, Settings, BarChart3, BookOpen, Clock, TrendingUp
    } = window['lucide-react'];
    const {
      LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
      Legend, AreaChart, Area
    } = Recharts;

    const PortfolioDashboard = () => {
      const [subjects, setSubjects] = useState([]);
      const [activeTab, setActiveTab] = useState('overview');
      const [showAddSubject, setShowAddSubject] = useState(false);
      const [newSubjectName, setNewSubjectName] = useState('');
      const [showAddGoal, setShowAddGoal] = useState(false);
      const [currentSubjectForGoal, setCurrentSubjectForGoal] = useState(null);
      const [newGoal, setNewGoal] = useState({
        title: '',
        type: 'basic',
        weight: 1,
        status: 'not_achieved',
        achievedDate: ''
      });

      useEffect(() => {
        const sampleSubjects = [
          {
            id: 1,
            name: 'Mathematik',
            learningGoals: [
              { id: 1, title: 'Bruchrechnung verstehen', type: 'basic', status: 'achieved', weight: 3, achievedDate: '2024-10-15' },
              { id: 2, title: 'Gleichungen lösen', type: 'basic', status: 'partial', weight: 2, achievedDate: '2024-11-20' },
              { id: 3, title: 'Geometrische Körper', type: 'basic', status: 'not_achieved', weight: 2, achievedDate: '' },
              { id: 4, title: 'Komplexe Textaufgaben', type: 'advanced', status: 'achieved', weight: 1, achievedDate: '2024-12-05' },
              { id: 5, title: 'Wahrscheinlichkeitsrechnung', type: 'advanced', status: 'partial', weight: 2, achievedDate: '2025-01-15' }
            ]
          },
          {
            id: 2,
            name: 'Deutsch',
            learningGoals: [
              { id: 6, title: 'Rechtschreibung', type: 'basic', status: 'achieved', weight: 4, achievedDate: '2024-09-10' },
              { id: 7, title: 'Textverständnis', type: 'basic', status: 'achieved', weight: 3, achievedDate: '2024-11-05' },
              { id: 8, title: 'Aufsatz schreiben', type: 'basic', status: 'partial', weight: 2, achievedDate: '2025-02-20' },
              { id: 9, title: 'Gedichtanalyse', type: 'advanced', status: 'partial', weight: 1, achievedDate: '2025-03-10' },
              { id: 10, title: 'Rhetorik', type: 'advanced', status: 'not_achieved', weight: 1, achievedDate: '' }
            ]
          }
        ];
        setSubjects(sampleSubjects);
      }, []);

      const generateTimelineFromGoals = (learningGoals) => {
        const months = ['August', 'September', 'Oktober', 'November', 'Dezember', 'Januar', 'Februar', 'März', 'April', 'Mai', 'Juni'];
        const timelineData = months.map(month => ({ month, basicAchieved: 0, basicPartial: 0, basicNotAchieved: 0, advancedAchieved: 0, advancedPartial: 0, advancedNotAchieved: 0 }));
        const basicGoals = learningGoals.filter(g => g.type === 'basic');
        const advancedGoals = learningGoals.filter(g => g.type === 'advanced');
        const basicTotal = basicGoals.length;
        const advancedTotal = advancedGoals.length;
        if (basicTotal) {
          const ach = basicGoals.filter(g => g.status === 'achieved').length;
          const par = basicGoals.filter(g => g.status === 'partial').length;
          const not = basicGoals.filter(g => g.status === 'not_achieved').length;
          timelineData.forEach(m => { m.basicAchieved = Math.round((ach/basicTotal)*100); m.basicPartial = Math.round((par/basicTotal)*100); m.basicNotAchieved = Math.round((not/basicTotal)*100); });
        }
        if (advancedTotal) {
          const ach = advancedGoals.filter(g => g.status === 'achieved').length;
          const par = advancedGoals.filter(g => g.status === 'partial').length;
          const not = advancedGoals.filter(g => g.status === 'not_achieved').length;
          timelineData.forEach(m => { m.advancedAchieved = Math.round((ach/advancedTotal)*100); m.advancedPartial = Math.round((par/advancedTotal)*100); m.advancedNotAchieved = Math.round((not/advancedTotal)*100); });
        }
        return timelineData;
      };

      const addSubject = () => { if (newSubjectName.trim()) { setSubjects([...subjects, { id: Date.now(), name: newSubjectName.trim(), learningGoals: [] }]); setNewSubjectName(''); setShowAddSubject(false); }};
      const removeSubject = id => { setSubjects(subjects.filter(s => s.id!==id)); if (activeTab===`subject-${id}`) setActiveTab('overview'); };
      const addLearningGoal = id => { setCurrentSubjectForGoal(id); setShowAddGoal(true); setNewGoal({ title:'', type:'basic', weight:1, status:'not_achieved', achievedDate:'' }); };
      const saveNewGoal = () => {
        if (newGoal.title.trim() && currentSubjectForGoal) {
          const goal = {...newGoal, id: Date.now(), weight: parseInt(newGoal.weight)};
          setSubjects(subjects.map(s => s.id===currentSubjectForGoal ? {...s, learningGoals:[...s.learningGoals, goal]} : s));
          setShowAddGoal(false); setCurrentSubjectForGoal(null);
        }
      };
      const cancelAddGoal = () => { setShowAddGoal(false); setCurrentSubjectForGoal(null); };

      const updateGoalStatus = (subId, goalId, status, date='') => {
        setSubjects(subjects.map(s => s.id===subId ? {...s, learningGoals: s.learningGoals.map(g => g.id===goalId ? {...g, status, achievedDate: status==='achieved' ? (date||new Date().toISOString().split('T')[0]) : status==='not_achieved' ? '' : g.achievedDate} : g)} : s));
      };
      const removeGoal = (subId, goalId) => { setSubjects(subjects.map(s => s.id===subId ? {...s, learningGoals: s.learningGoals.filter(g=>g.id!==goalId)} : s)); };
      const getStatusColor = s => s==='achieved'?'#22c55e':s==='partial'?'#f59e0b':s==='not_achieved'?'#ef4444':'#6b7280';
      const getStatusText = s => s==='achieved'?'Erreicht':s==='partial'?'Teilweise erreicht':s==='not_achieved'?'Noch nicht erreicht':'Unbewertet';
      const getBubbleData = subject => {
        const data = {};
        subject.learningGoals.forEach(g=>{ const key=`${g.type}-${g.status}`; if(!data[key]) data[key]={type:g.type,status:g.status,count:0,totalWeight:0}; data[key].count++; data[key].totalWeight+=g.weight; });
        return Object.values(data);
      };

      const SubjectTimelineVisualization = ({subject}) => {
        const data = generateTimelineFromGoals(subject.learningGoals);
        if (!data.length) return (<div className="bg-white p-6 rounded-lg border shadow-sm"><h3>Entwicklung im Schuljahr - {subject.name}</h3><p>Keine Timeline-Daten verfügbar.</p></div>);
        return (<div className="space-y-6">[...]</div>); // Verkürzt für Lesbarkeit
      };
      const BubbleVisualization = ({subject}) => { const bd=getBubbleData(subject); const maxW=Math.max(...bd.map(b=>b.totalWeight),1); return (<div>...</div>); };
      const SubjectManagement = ({subject}) => (<div className="space-y-6"><BubbleVisualization subject={subject}/><SubjectTimelineVisualization subject={subject}/></div>);
      const currentSubject = subjects.find(s => activeTab===`subject-${s.id}`);

      return (
        <div className="min-h-screen bg-gray-100">...</div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<PortfolioDashboard />);
  </script>
</body>
</html>
